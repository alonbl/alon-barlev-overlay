From d3eaccade0439899a4aab555f13113579311847f Mon Sep 17 00:00:00 2001
From: Alon Bar-Lev <alon.barlev@gmail.com>
Date: Wed, 15 Aug 2012 09:46:42 +0300
Subject: [PATCH 4/4] support route metric

This adds optional ROUTE_METRIC environment variable to vpnc-script to
allow set non default routes and dns metrics.

Signed-off-by: Alon Bar-Lev <alon.barlev@gmail.com>
---
 vpnc-script |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/vpnc-script b/vpnc-script
index 2058ab7..e07b879 100755
--- a/vpnc-script
+++ b/vpnc-script
@@ -234,7 +234,7 @@ if [ -n "$IPROUTE" ]; then
 		NETWORK="$1"
 		NETMASK="$2"
 		NETMASKLEN="$3"
-		$IPROUTE route replace "$NETWORK/$NETMASKLEN" dev "$TUNDEV"
+		$IPROUTE route replace "$NETWORK/$NETMASKLEN" dev "$TUNDEV" ${ROUTE_METRIC:+metric ${ROUTE_METRIC}}
 		$IPROUTE route flush cache
 	}
 
@@ -549,7 +549,7 @@ nameserver $i"
 		NEW_RESOLVCONF="$NEW_RESOLVCONF
 domain $CISCO_DEF_DOMAIN"
 	fi
-	echo "$NEW_RESOLVCONF" | ${RESOLVCONF} -a $TUNDEV
+	echo "$NEW_RESOLVCONF" | ${RESOLVCONF} ${ROUTE_METRIC:+-m ${ROUTE_METRIC}} -a $TUNDEV
 }
 
 restore_resolvconf_manager() {
-- 
1.7.8.6

